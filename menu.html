<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu - Malaysian Street Food Explorer</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <meta name="description" content="Browse the Malaysian Street Food menu by category.">
</head>
<body>
    <nav class="navbar navbar-expand-lg header">
        <div class="container">
            <a class="navbar-brand logo" href="index.html">
                <i class="fas fa-utensils me-2"></i>Malaysian Street Food
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="food.html">Food</a></li>
                    <li class="nav-item"><a class="nav-link" href="about.html">About Us</a></li>
                    <li class="nav-item"><a class="nav-link active" href="menu.html">Menu</a></li>
                    <li class="nav-item"><a class="nav-link" href="map.html">Map</a></li>
                    <li class="nav-item"><a class="nav-link" href="login.html">Login</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="page-container">
        <div class="container">
            <div class="card p-4">
                <h2 class="mb-2">Our Menu</h2>
                <div id="filterBar" class="mb-4 d-flex flex-wrap gap-2" role="group" aria-label="Menu filters">
                    <button type="button" class="btn btn-sm btn-outline-light" data-filter="all">All</button>
                    <button type="button" class="btn btn-sm btn-danger" data-filter="spicy"><i class="fas fa-pepper-hot me-1"></i>Spicy</button>
                    <button type="button" class="btn btn-sm btn-secondary" data-filter="not-spicy">Not Spicy</button>
                    <button type="button" class="btn btn-sm btn-dark" data-filter="beef"><i class="fas fa-drumstick-bite me-1"></i>Contains Beef</button>
                    <button type="button" class="btn btn-sm btn-warning text-dark" data-filter="pork"><i class="fas fa-bacon me-1"></i>Contains Pork</button>
                    <button type="button" class="btn btn-sm btn-success" data-filter="no-beef-pork"><i class="fas fa-check me-1"></i>No Beef/Pork</button>
                </div>
                <div id="menuGrid" class="row g-4"></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="script.js"></script>

    <div id="cookieConsentBanner" class="cookie-consent-banner">
        <p>
            This website uses cookies to ensure you get the best experience.
            By clicking "Accept", you agree to our use of cookies.
        </p>
        <div class="cookie-consent-buttons">
            <button id="acceptCookies" class="btn btn-primary">Accept</button>
            <button id="declineCookies" class="btn btn-secondary">Decline</button>
        </div>
    </div>

    <footer>
        <div class="container text-center py-4">
            <div class="row">
                <div class="col-md-3"><a href="terms.html" class="text-white text-decoration-none">Terms & Conditions</a></div>
                <div class="col-md-3"><a href="privacy.html" class="text-white text-decoration-none">Privacy & Policy</a></div>
                <div class="col-md-3"><a href="feedback.html" class="text-white text-decoration-none">Feedback</a></div>
                <div class="col-md-3"><a href="contact.html" class="text-white text-decoration-none">Contact Us</a></div>
            </div>
            <p class="text-white mt-3">&copy; 2023 Malaysian Street Food Explorer</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            if (typeof streetFoods === 'undefined') return;
            const grid = document.getElementById('menuGrid');
            const filterBar = document.getElementById('filterBar');

            const deriveFlags = (food) => {
                const text = (food.description + ' ' + food.ingredients).toLowerCase();
                const hasAny = (words) => words.some(w => text.includes(w));
                const flags = {
                    spicy: hasAny([' spicy','spicy ','spice','chili','chilli','cili','sambal','rendang','laksa','kari','curry','pedas','tempoyak']),
                    beef: hasAny(['beef','daging']),
                    pork: hasAny(['pork','char siu','lard','bak kut teh'])
                };
                // Name-based overrides for known non-spicy dishes
                const nonSpicyByName = [
                    'Char Kway Teow', 'Kway Teow Kia', 'Apam Johol', 'Keropok Lekor',
                    'Sata', 'Pulut Panggang', 'Chicken Rice Balls', 'Cendol',
                    'Bak Kut Teh', 'Ikan Bakar Perlis'
                ];
                if (nonSpicyByName.some(n => n.toLowerCase() === food.name.toLowerCase())) {
                    flags.spicy = false;
                }
                flags.notSpicy = !flags.spicy;
                flags.noBeefPork = !flags.beef && !flags.pork;
                return flags;
            };

            const foodsWithFlags = streetFoods.map(f => ({...f, flags: deriveFlags(f)}));

            const toHtml = (food) => {
                const f = food.flags;
                const badges = `
                    ${f.spicy ? '<span class="badge bg-danger me-1"><i class=\"fas fa-pepper-hot me-1\"></i>Spicy</span>' : '<span class="badge bg-secondary me-1">Not Spicy</span>'}
                    ${f.beef ? '<span class="badge bg-dark me-1"><i class=\"fas fa-drumstick-bite me-1\"></i>Contains Beef</span>' : ''}
                    ${f.pork ? '<span class="badge bg-warning text-dark me-1"><i class=\"fas fa-bacon me-1\"></i>Contains Pork</span>' : ''}
                    ${f.noBeefPork ? '<span class="badge bg-success"><i class=\"fas fa-check me-1\"></i>No Beef/Pork</span>' : ''}
                `;
                return `
                    <div class="col-md-4">
                        <div class="card food-card h-100">
                            <img src="${food.image}" alt="${food.name}" class="food-image">
                            <div class="card-body">
                                <h5 class="card-title">${food.name}</h5>
                                <p class="card-text">${food.description}</p>
                                <div class="d-flex flex-wrap gap-2">${badges}</div>
                            </div>
                        </div>
                    </div>
                `;
            };

            let currentFilter = 'all';
            const render = () => {
                let items = foodsWithFlags;
                if (currentFilter === 'spicy') items = items.filter(x => x.flags.spicy);
                if (currentFilter === 'not-spicy') items = items.filter(x => x.flags.notSpicy);
                if (currentFilter === 'beef') items = items.filter(x => x.flags.beef);
                if (currentFilter === 'pork') items = items.filter(x => x.flags.pork);
                if (currentFilter === 'no-beef-pork') items = items.filter(x => x.flags.noBeefPork);
                grid.innerHTML = items.map(toHtml).join('');
            };

            filterBar.addEventListener('click', (e) => {
                const btn = e.target.closest('button[data-filter]');
                if (!btn) return;
                currentFilter = btn.getAttribute('data-filter');
                Array.from(filterBar.querySelectorAll('button')).forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                render();
            });

            // Init: mark All active and render
            const allBtn = filterBar.querySelector('button[data-filter="all"]');
            if (allBtn) allBtn.classList.add('active');
            render();
        });
    </script>
</body>
</html>
